KGBuilder - веб-приложение для генерации баз данных KGBase из исходных данных, часть проекта KGBase (http://kgbase.ru)

0.1 - первая версия для разработчиков.
********************************************************************************
Алгоритм работы приложения:

Приложение состоит из трех основных файлов: index.php - пользовательский интерфейс и логика приложения; functions.php - вызываемый логической частью функционал приложения; settings.php - настройки приложения и формируемых баз данных.

Стартовая страница пользовательского интерфейса приложения предлагает выбрать одну из баз для формирования (в соответствии с содержимым массива $set в settings.php). Поле checkbox каждой из форм определяет, будут ли при формировании базы данных выводиться уведомления о коллекционных образцах, названия таксонов которых отсутствуют в установленном для базы таксономическом списке (определен в $set[n]['src']['tax'] в settings.php).

После передачи данных из формы приложение загружает указанный таксономический список, преобразует его в массив и xml-дерево и извлекает в отдельный ассоциативный массив полный список названий таксонов. В соответствии со значениями массива $set[n]['src']['data'] загружаются данные о коллекционных образцах и локалитетах их сбора (включая геоданные). Каждый элемент массива $set[n]['src']['data'] представляет собой пару источников коллеция-геоданные, обрабатываемые совместно (для каждой формируемой базы данных может быть установлено произвольное число таких пар источников). Соответственно, каждая пара источников преобразуется в массивы, а затем в xml-деревья, содержимое которых последовательно записывается в два общих для формируемой базы xml-дерева: коллекционных данных и геоданных.

Далее полученное дерево коллекционных образцов источников сравнивается с массивом названий таксонов таксономического списка, созданным ранее. Если для коллекционного образца в источнике было установлено название, присутствующее в таксономическом списке - образец включается в результаты обработки. Если название в списке отсутствует - образец игнорируется при обработке. В зависимости от наличия и значения переменной $control (передается из поля checkbox формы интерфейса приложения) сообщения об этом (с указанием таксона и номера образца) либо передаются на страницу с результатами обработки, либо нет. Таким образом, возможно контролировать корректность фильтрации данных по таксономическому списку, и корректность таксономических названий образцов (возможные опечатки и т.д.). В случае включения коллекционного образца в результаты обработки данные о локалитете сбора включаются в параллельно формируемое xml-дерево геоданных. На основе полученного xml-дерева коллекционных образцов формируется список коллекций, в которых они хранятся. Сведения об этих коллекциях копируются из файла с общим списком всех коллекций баз, указанного в переменной $src_path['collections'] в settings.php (сравнение производится по сокращенному названию - 'name'). Скопированные данные о коллекциях также формируются в xml-дерево.

На последнем этапе работы приложения полученные xml-деревья (таксономия, коллекция, геоданные, список коллекций хранения) записываются в файлы в созданную директорию (если она уже существует - предварительно удаляется) в соответствии с настройками базы данных в settings.php - переменной $upl_path и соответствующим элементом массива $set. В соответствии с последним формируется xml-файл - индекс базы и записывается туда же. Из установленной в настройках для базы директории в итоговую директорию копируются файл карты с файлом ее привязки (blank.jpg и blank.kml - предварительно подготовленная "пустая" карта для отображения локалитетов базы). Далее все загруженные данные базы копируются в zip-архив с названием, аналогичным названию директории. Таким образом, работа приложения завершается. Пользователь получает сообщение о завершении и html-ссылку на архив с данными базы.

-------------------------------------------------------------------------------------

Формат и структура исходных данных:

Представленная версия приложения поддерживает крайне ограниченный перечень форматов исходных данных. В файле настроек settings.php для каждого источника указан тип данных ('type' в элементах массива $set) и данные для доступа к нему. Расширение перечня возможных типов источников требует добавления соответствующего условия выбора в логику работы приложения и написания дополнительного функционала для работы с данным типом.

Общая структура данных, используемая в KGBase, подробно описана на сайте проекта (http://kgbase.ru/?page_id=27). Применительно к исходным ресурсам, передаваемым в данное приложение - термины описания по ссылке могут трактоваться: "структура данных" - так "вид источника данных" (таксономия, коллекция, геоданные) или конкретный источник (файл или база с набором таблиц); "класс " - как "таблица", "атрибут" - как "поле таблицы".

Таксономические списки могут быть переданы приложению данной версии только в формате ODS (Open Document Spreadsheet - формат пакета Open Office) - в виде, генерируемом приложением tax_build.php из пакета административных скриптов KGBase (директория admin). Структура этих таблиц является достаточно простой и очевидной из представленных в директории src/taxonomy примеров. index - общие данные о списке с указанием высшего ранга таксона в нем; ranks - перечень рангов таксономии, имеющихся в списке; content - описание полей с данными таксонов; content synonym - аналогично для синонимов таксонов; прочие таблицы - соответствуют рангам таксонов (таксоны рангов и их синонимы соответственно). Очевидно, что такой набор таблиц может быть создан вручную самостоятельно.

Геоданные в приложении данной версии также обрабатываются только в формате ODS. Структура файла полностью соответствует описанию по ссылке выше.

Данные о наборе коллекционных образцов могут быть переданы приложению как в формате ODS, так и как источник данных ОDBC. Последний вариант в данном случае предполагает использование в качестве источника исходных файла базы данных Microsoft Access (.accdb). В силу ряда причин (в первую очередь - наличия удобного интерфейса для работы со связанными таблицами) разработчик проекта KGBase полагает обработку данные о коллекциях именно в данной программе весьма удобной. Для использования в приложении KGBuilder файл MicrosoftAccess должен быть подключен в операционной системе как источник данных ОDBC (Панель управления -> Администрирование -> Источники данных (ODBC) -> Системный источник -> Microsoft Access Driver, указать имя источника, выбрать файл базы данных, в "Дополнительно" определить пользователя и его пароль). Структура данных источника также полностью соответствует описанию по ссылке на сайт проекта KGBase выше.

-------------------------------------------------------------------------------------

Пользовательский интерфейс для управления ресурсами данных и настройками формируемых приложением баз данных, а также поддержка более широкого перечня источников данных для каждого вида ресурсов (включая базы данных MySQL) - предметы предполагаемой дальнейшей разработки приложения.

-------------------------------------------------------------------------------------

Разработка: ФГБУ "Государственный заповедник "Богдинско-Баскунчакский", К.А. Гребенников (kgrebennikov@gmail.com). Свободное программное обеспечение (лицензия GNU General public license v.3) (текст: license.txt).